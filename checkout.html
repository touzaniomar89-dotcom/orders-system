<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</title>

<style>
body{
  font-family: Arial;
  background:#111;
  color:white;
  text-align:center;
}

.box{
  background:#222;
  width:350px;
  margin:30px auto;
  padding:20px;
  border-radius:10px;
}

button{
  background:#00e676;
  border:none;
  padding:10px 20px;
  cursor:pointer;
  border-radius:6px;
}

.remove{
  background:red;
  color:white;
  padding:5px 10px;
  margin-right:10px;
}
</style>
</head>
<body>

<h2>ğŸ›’ Ø§Ù„Ø³Ù„Ø©</h2>

<div class="box">
  <div id="cartItems"></div>
  <h3 id="total"></h3>
</div>

<h2>ğŸ“¦ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨</h2>

<div class="box">
<form id="orderForm">
  <input id="name" placeholder="Ø§Ø³Ù…Ùƒ" required><br><br>
  <input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required><br><br>
  <input id="city" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©" required><br><br>
  <input id="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" required><br><br>
  <button type="submit">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
</form>
</div>

<script>

let cart = JSON.parse(localStorage.getItem("cart")) || [];
let total = 0;

function renderCart(){
  let html = "";
  total = 0;

  cart.forEach((item, index)=>{
    total += item.price * item.quantity;

    html += `
      <p>
        ${item.name} - ${item.quantity} Ã— ${item.price} Ø±.Ø³
        <button class="remove" onclick="removeItem(${index})">X</button>
      </p>
    `;
  });

  document.getElementById("cartItems").innerHTML = html;
  document.getElementById("total").innerText = "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: " + total + " Ø±.Ø³";
}

function removeItem(index){
  cart.splice(index,1);
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

renderCart();

document.getElementById("orderForm").addEventListener("submit", async function(e){
  e.preventDefault();
  
  if(cart.length === 0){
    alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© ğŸ›’");
    return;
  }

  const data = {
    name: document.getElementById("name").value,
    phone: document.getElementById("phone").value,
    city: document.getElementById("city").value,
    address: document.getElementById("address").value,
    cart: cart,
    total: total
  };

  try{

    const response = await fetch("/api/submit", {
      method:"POST",
      headers:{
        "Content-Type":"application/json"
      },
      body: JSON.stringify(data)
    });

    if(response.ok){
      localStorage.removeItem("cart");
      window.location.href="thankyou.html";
    }else{
      alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨");
    }

  }catch(error){
    alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…");
  }

});

</script>
  
</body>
</html>

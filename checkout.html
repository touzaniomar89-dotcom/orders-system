<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WDZ | Checkout</title>

<style>
body{
  margin:0;
  background:#0b0b0b;
  color:#fff;
  font-family:Arial;
  text-align:center;
}
.container{
  max-width:500px;
  margin:80px auto;
}
input{
  width:100%;
  padding:14px;
  margin-bottom:15px;
  border-radius:8px;
  border:1px solid #222;
  background:#111;
  color:#fff;
}
button{
  width:100%;
  padding:16px;
  background:#00ff66;
  border:none;
  font-weight:bold;
  cursor:pointer;
}
button.loading{
  opacity:.6;
  pointer-events:none;
}
.summary{
  margin-bottom:30px;
  background:#111;
  padding:20px;
  border-radius:10px;
}
.total{
  color:#00ff66;
  font-size:20px;
  font-weight:bold;
}
</style>
</head>
<body>

<div class="container">

<h1>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</h1>

<div id="summaryBox"></div>

<form id="orderForm">
<input type="text" name="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" required>
<input type="text" name="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required>
<input type="text" name="city" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©" required>
<input type="text" name="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„" required>
<button type="submit" id="submitBtn">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
</form>

</div>

<script>

// ğŸ”¥ Ø±Ø§Ø¨Ø· Google Apps Script Ø§Ù„Ø¬Ø¯ÙŠØ¯
const API_URL = "https://script.google.com/macros/s/AKfycbxyCmZ7W1k-xW361TttJ2SZT1QoYjA16TGy4Negnq2VkVBKS25E-pbTF1tTBuPefXvDcg/exec";

// ğŸ“¦ Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† localStorage
const order = JSON.parse(localStorage.getItem("order"));

if(!order){
  document.body.innerHTML = "<h2 style='margin-top:150px'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨ Ù†Ø´Ø·</h2>";
}else{

  // Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨
  document.getElementById("summaryBox").innerHTML = `
    <div class="summary">
      <p>Ø§Ù„Ù…Ù†ØªØ¬: ${order.name}</p>
      <p>Ø§Ù„Ù…Ù‚Ø§Ø³: ${order.size}</p>
      <p>Ø§Ù„Ù„ÙˆÙ†: ${order.color}</p>
      <p>Ø§Ù„ÙƒÙ…ÙŠØ©: ${order.quantity}</p>
      <p class="total">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${order.price * order.quantity} MAD</p>
    </div>
  `;

}

// ğŸš€ Ø¹Ù†Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
document.getElementById("orderForm").addEventListener("submit", async function(e){

  e.preventDefault();

  if(!order){
    alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨");
    return;
  }

  const btn = document.getElementById("submitBtn");
  btn.classList.add("loading");
  btn.innerText = "Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

  const payload = {
    name: this.name.value,
    phone: this.phone.value,
    city: this.city.value,
    address: this.address.value,
    product: order.name,
    size: order.size,
    color: order.color,
    quantity: order.quantity,
    total: order.price * order.quantity
  };

  try{

    await fetch(API_URL,{
      method:"POST",
      mode:"no-cors", // ğŸ”¥ Ù…Ù‡Ù… Ø¬Ø¯Ø§ Ù„ØªÙØ§Ø¯ÙŠ CORS
      headers:{
        "Content-Type":"application/json"
      },
      body: JSON.stringify(payload)
    });

    // Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ†
    localStorage.removeItem("order");

    // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„Ø´ÙƒØ±
    window.location.href="thankyou.html";

  }catch(error){

    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨");
    console.error(error);

    btn.classList.remove("loading");
    btn.innerText="ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨";
  }

});
</script>

</body>
</html>

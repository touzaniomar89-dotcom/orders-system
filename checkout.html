<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WDZ | إتمام الطلب</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700&family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">

<style>
:root{
    --bg:#0b0b0b;
    --card:#111;
    --accent:#00ff66;
    --text:#fff;
    --muted:#888;
    --border:#1a1a1a;
}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--text);font-family:'Montserrat',sans-serif;}
header{position:fixed;top:0;width:100%;background:rgba(0,0,0,.9);border-bottom:1px solid var(--border);z-index:1000;}
.nav{max-width:1200px;margin:auto;padding:18px 20px;display:flex;justify-content:space-between;align-items:center;}
.logo{font-family:'Orbitron',sans-serif;letter-spacing:2px;color:var(--accent);}
.nav a{color:#fff;text-decoration:none;margin-left:25px;font-size:14px;}
.wrapper{max-width:1200px;margin:120px auto 80px;padding:0 20px;display:grid;grid-template-columns:1fr 1fr;gap:60px;}
.card{background:var(--card);padding:40px;border-radius:20px;border:1px solid var(--border);}
h2{font-family:'Orbitron',sans-serif;font-size:20px;margin-bottom:30px;}
.summary-item{margin-bottom:14px;color:var(--muted);font-size:15px;}
.summary-total{margin-top:25px;padding-top:20px;border-top:1px solid var(--border);font-size:24px;font-weight:800;color:var(--accent);}
input{width:100%;padding:16px;margin-bottom:20px;background:#0f0f0f;border:1px solid var(--border);color:#fff;border-radius:12px;font-size:14px;}
input:focus{outline:none;border-color:var(--accent);}
button{width:100%;padding:18px;background:var(--accent);border:none;font-weight:800;font-size:16px;cursor:pointer;border-radius:14px;}
button.loading{opacity:.7;pointer-events:none;}
.trust{margin-top:25px;font-size:13px;color:var(--muted);line-height:1.8;border-top:1px solid var(--border);padding-top:20px;}
.empty{text-align:center;margin-top:150px;font-family:'Orbitron',sans-serif;}
@media(max-width:900px){.wrapper{grid-template-columns:1fr}}
</style>
</head>
<body>

<header>
  <div class="nav">
    <div class="logo">WDZ</div>
    <div>
      <a href="index.html">الرئيسية</a>
      <a href="product.html">المنتج</a>
      <a href="checkout.html">الدفع</a>
    </div>
  </div>
</header>

<div id="content"></div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxyCmZ7W1k-xW361TttJ2SZT1QoYjA16TGy4Negnq2VkVBKS25E-pbTF1tTBuPefXvDcg/exec";
const order = JSON.parse(localStorage.getItem("order"));

if(!order){
    document.getElementById("content").innerHTML =
        "<div class='empty'>لا يوجد طلب نشط</div>";
}else{

document.getElementById("content").innerHTML = `
<div class="wrapper">

<div class="card">
<h2>ملخص الطلب</h2>
<div class="summary-item">المنتج: ${order.name}</div>
<div class="summary-item">المقاس: ${order.size}</div>
<div class="summary-item">اللون: ${order.color}</div>
<div class="summary-item">الكمية: ${order.quantity}</div>
<div class="summary-total">المجموع: ${order.price * order.quantity} MAD</div>
</div>

<div class="card">
<h2>معلومات العميل</h2>

<form id="orderForm">
<input type="text" name="name" placeholder="الاسم الكامل" required>
<input type="text" name="phone" placeholder="رقم الهاتف" required>
<input type="text" name="city" placeholder="المدينة" required>
<input type="text" name="address" placeholder="العنوان الكامل" required>
<button type="submit" id="submitBtn">تأكيد الطلب</button>
</form>

<div class="trust">
✔ الدفع عند الاستلام<br>
✔ توصيل سريع لجميع مدن المغرب<br>
✔ سيتم التواصل خلال 24 ساعة
</div>

</div>
</div>
`;

document.getElementById("orderForm").addEventListener("submit", async function(e){
    e.preventDefault();

    const btn = document.getElementById("submitBtn");
    btn.classList.add("loading");
    btn.innerText = "جارٍ الإرسال...";

    const payload = {
        name: this.name.value,
        phone: this.phone.value,
        city: this.city.value,
        address: this.address.value,
        product: order.name,
        size: order.size,
        color: order.color,
        quantity: order.quantity,
        total: order.price * order.quantity
    };

    try{
        await fetch(API_URL,{
            method:"POST",
            mode:"no-cors",
            headers:{
                "Content-Type":"application/json"
            },
            body: JSON.stringify(payload)
        });

        localStorage.removeItem("order");
        window.location.href="thankyou.html";

    }catch(error){
        alert("حدث خطأ أثناء إرسال الطلب");
        console.error(error);
        btn.classList.remove("loading");
        btn.innerText = "تأكيد الطلب";
    }

});
}
</script>

</body>
</html>
